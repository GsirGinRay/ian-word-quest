<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ian's Word Quest</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Utility */
.hidden { display: none !important; }

/* Views */
.view { display: none; min-height: 100vh; padding: 20px; }
.view.active { display: flex; flex-direction: column; }

/* Buttons */
.btn {
    padding: 18px 36px;
    border-radius: 16px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    transition: all 0.2s;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}
.btn:active { transform: scale(0.95); }
.btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.btn-secondary { background: #374151; color: white; border: 2px solid #4b5563; }
.btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
.btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; }
.btn-large {
    width: 100%;
    padding: 24px;
    font-size: 20px;
    margin-bottom: 16px;
    text-align: left;
    border-radius: 20px;
}

/* Cards */
.card {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 24px;
    border: 1px solid rgba(255,255,255,0.1);
}

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    margin-bottom: 20px;
}

/* Status */
#status-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 8px;
    text-align: center;
    font-size: 14px;
    font-weight: bold;
    z-index: 1000;
    transition: all 0.3s;
}
.status-connecting { background: #dc2626; }
.status-online { background: #16a34a; }

/* Modal */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    padding: 20px;
}
.modal-box {
    background: #1f2937;
    padding: 30px;
    border-radius: 24px;
    width: 100%;
    max-width: 400px;
    border: 1px solid #374151;
}
.modal-box h2 { margin-bottom: 20px; font-size: 24px; }
.modal-box input {
    width: 100%;
    padding: 16px;
    border-radius: 12px;
    border: 2px solid #374151;
    background: #374151;
    color: white;
    font-size: 18px;
    margin-bottom: 20px;
}
.modal-box input:focus { outline: none; border-color: #667eea; }

/* Login View */
#login-view {
    align-items: center;
    justify-content: center;
    text-align: center;
}
.logo { font-size: 48px; margin-bottom: 10px; }
.title { font-size: 32px; color: #fbbf24; margin-bottom: 10px; }
.subtitle { color: #9ca3af; margin-bottom: 40px; font-size: 18px; }

.user-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 16px;
    width: 100%;
    max-width: 600px;
    margin-bottom: 30px;
}
.user-card {
    background: rgba(255,255,255,0.1);
    padding: 24px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid transparent;
}
.user-card:hover, .user-card:active {
    background: rgba(255,255,255,0.2);
    border-color: #667eea;
    transform: scale(1.02);
}
.user-avatar { font-size: 48px; margin-bottom: 8px; }
.user-name { font-weight: bold; font-size: 16px; }
.user-level { color: #fbbf24; font-size: 14px; margin-top: 4px; }

/* Dashboard */
.dash-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 30px;
}
.dash-user {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255,255,255,0.1);
    padding: 12px 20px;
    border-radius: 50px;
}
.dash-avatar { font-size: 32px; }
.dash-info h3 { font-size: 16px; }
.dash-info span { color: #fbbf24; font-size: 14px; }

.level-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
}
.level-card {
    background: linear-gradient(135deg, rgba(102,126,234,0.3) 0%, rgba(118,75,162,0.3) 100%);
    padding: 24px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid transparent;
    text-align: center;
}
.level-card:hover, .level-card:active {
    border-color: #667eea;
    transform: scale(1.02);
}
.level-num { font-size: 36px; font-weight: bold; color: #fbbf24; }
.level-words { color: #9ca3af; font-size: 14px; margin-top: 8px; }
.level-difficulty { font-size: 12px; margin-top: 4px; padding: 4px 8px; border-radius: 8px; display: inline-block; }
.diff-Easy { background: #22c55e; }
.diff-Normal { background: #eab308; }
.diff-Hard { background: #ef4444; }

/* Game View */
#game-view { padding: 0; }
.game-header {
    background: rgba(0,0,0,0.3);
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.progress-bar {
    flex: 1;
    margin: 0 20px;
    height: 12px;
    background: #374151;
    border-radius: 10px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transition: width 0.3s;
}
.progress-text { color: #fbbf24; font-weight: bold; }

.game-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    text-align: center;
}

.word-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px 60px;
    border-radius: 30px;
    margin-bottom: 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}
.word-english {
    font-size: 42px;
    font-weight: bold;
    margin-bottom: 10px;
}
.word-hint {
    color: rgba(255,255,255,0.7);
    font-size: 16px;
}

.choices {
    width: 100%;
    max-width: 500px;
}
.choice-btn {
    width: 100%;
    padding: 20px 24px;
    margin-bottom: 12px;
    background: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}
.choice-btn:hover, .choice-btn:active {
    background: rgba(255,255,255,0.2);
    border-color: #667eea;
}
.choice-btn.correct {
    background: #22c55e !important;
    border-color: #22c55e !important;
}
.choice-btn.wrong {
    background: #ef4444 !important;
    border-color: #ef4444 !important;
}
.choice-btn:disabled {
    cursor: not-allowed;
    opacity: 0.7;
}

/* Result overlay */
.result-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    padding: 20px;
}
.result-box {
    background: #1f2937;
    padding: 40px;
    border-radius: 30px;
    text-align: center;
    max-width: 400px;
    width: 100%;
}
.result-emoji { font-size: 80px; margin-bottom: 20px; }
.result-title { font-size: 28px; margin-bottom: 10px; }
.result-score { color: #fbbf24; font-size: 20px; margin-bottom: 30px; }

/* Admin */
.admin-section {
    background: rgba(255,255,255,0.05);
    padding: 24px;
    border-radius: 20px;
    margin-bottom: 20px;
}
.admin-section h3 { margin-bottom: 16px; color: #fbbf24; }
.admin-input {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 2px solid #374151;
    background: #374151;
    color: white;
    font-size: 16px;
    margin-bottom: 12px;
}
.admin-input:focus { outline: none; border-color: #667eea; }

.level-list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    margin-bottom: 8px;
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6b7280;
}
.empty-state p { margin-bottom: 10px; }
</style>
</head>
<body>

<div id="status-bar" class="status-connecting">ğŸ”„ é€£ç·šä¸­...</div>

<!-- LOGIN VIEW -->
<div id="login-view" class="view active">
    <div class="logo">ğŸ“š</div>
    <h1 class="title">Ian's Word Quest</h1>
    <p class="subtitle">é¸æ“‡ç©å®¶é–‹å§‹éŠæˆ²</p>

    <div id="user-grid" class="user-grid">
        <p style="color: #6b7280; grid-column: 1/-1;">è¼‰å…¥ä¸­...</p>
    </div>

    <button id="btn-add-player" class="btn btn-secondary">
        â• æ–°å¢ç©å®¶
    </button>
</div>

<!-- ADD USER MODAL -->
<div id="modal-add-user" class="modal-overlay hidden">
    <div class="modal-box">
        <h2>ğŸ¦¸ æ–°å¢ç©å®¶</h2>
        <input type="text" id="input-username" placeholder="è¼¸å…¥åå­—">
        <div style="display: flex; gap: 12px;">
            <button id="btn-cancel-add" class="btn btn-secondary" style="flex:1">å–æ¶ˆ</button>
            <button id="btn-confirm-add" class="btn btn-primary" style="flex:1">å»ºç«‹</button>
        </div>
    </div>
</div>

<!-- DASHBOARD VIEW -->
<div id="dashboard-view" class="view">
    <div class="dash-header">
        <button id="btn-logout" class="btn btn-secondary" style="padding: 12px 20px;">â† ç™»å‡º</button>
        <div class="dash-user">
            <span id="dash-avatar" class="dash-avatar">ğŸ‘¦</span>
            <div class="dash-info">
                <h3 id="dash-name">Player</h3>
                <span id="dash-level">LV.1</span>
            </div>
        </div>
        <button id="btn-admin" class="btn btn-secondary" style="padding: 12px 20px;">âš™ï¸</button>
    </div>

    <h2 style="margin-bottom: 20px; font-size: 24px;">ğŸ® é¸æ“‡é—œå¡</h2>

    <div id="level-grid" class="level-grid"></div>

    <div id="empty-levels" class="empty-state hidden">
        <p style="font-size: 48px; margin-bottom: 20px;">ğŸ“­</p>
        <p>ç›®å‰æ²’æœ‰é—œå¡</p>
        <p>è«‹åˆ°è¨­å®šæ–°å¢é—œå¡</p>
    </div>
</div>

<!-- GAME VIEW -->
<div id="game-view" class="view">
    <div class="game-header">
        <button id="btn-quit" class="btn btn-danger" style="padding: 10px 16px; font-size: 14px;">âœ– é›¢é–‹</button>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <span id="progress-text" class="progress-text">0/5</span>
    </div>

    <div class="game-content">
        <div class="word-card">
            <div id="word-english" class="word-english">Word</div>
            <div class="word-hint">é¸æ“‡æ­£ç¢ºçš„ä¸­æ–‡æ„æ€</div>
        </div>

        <div id="choices" class="choices"></div>
    </div>
</div>

<!-- RESULT OVERLAY -->
<div id="result-overlay" class="result-overlay hidden">
    <div class="result-box">
        <div id="result-emoji" class="result-emoji">ğŸ‰</div>
        <h2 id="result-title" class="result-title">å¤ªæ£’äº†ï¼</h2>
        <p id="result-score" class="result-score">ç­”å° 5/5 é¡Œï¼Œç²å¾— 100 XPï¼</p>
        <button id="btn-result-ok" class="btn btn-primary" style="width: 100%;">ç¹¼çºŒ</button>
    </div>
</div>

<!-- ADMIN VIEW -->
<div id="admin-view" class="view">
    <div class="header">
        <h2>âš™ï¸ è¨­å®š</h2>
        <button id="btn-back-dash" class="btn btn-secondary" style="padding: 12px 20px;">â† è¿”å›</button>
    </div>

    <div class="admin-section">
        <h3>ğŸ“¤ ä¸Šå‚³é—œå¡ (Excel)</h3>
        <form id="upload-form">
            <input type="text" name="title" class="admin-input" placeholder="é—œå¡åç¨±" required>
            <select name="difficulty" class="admin-input">
                <option value="Easy">ç°¡å–®</option>
                <option value="Normal">æ™®é€š</option>
                <option value="Hard">å›°é›£</option>
            </select>
            <input type="file" name="file" accept=".xlsx" class="admin-input" required>
            <button type="submit" id="btn-upload" class="btn btn-primary" style="width: 100%;">ä¸Šå‚³</button>
            <p id="upload-status" style="text-align: center; margin-top: 12px;"></p>
        </form>
    </div>

    <div class="admin-section">
        <h3>ğŸ“‹ ç¾æœ‰é—œå¡</h3>
        <div id="admin-level-list"></div>
    </div>
</div>

<script>
// ===== STATE =====
var currentUser = null;
var currentLevel = null;
var gameWords = [];
var currentWordIndex = 0;
var correctCount = 0;
var allWords = []; // Cache all words for generating wrong choices

// ===== UTILITY =====
function setStatus(msg, type) {
    var el = document.getElementById("status-bar");
    el.textContent = msg;
    el.className = type === "online" ? "status-online" : "status-connecting";
    if (type === "online") {
        setTimeout(function() { el.style.opacity = "0"; }, 2000);
    }
}

function switchView(viewId) {
    document.querySelectorAll(".view").forEach(function(v) { v.classList.remove("active"); });
    document.getElementById(viewId).classList.add("active");
}

function shuffleArray(arr) {
    var result = arr.slice();
    for (var i = result.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = result[i];
        result[i] = result[j];
        result[j] = temp;
    }
    return result;
}

// ===== API =====
async function fetchUsers() {
    setStatus("ğŸ”„ é€£ç·šä¸­...", "connecting");
    try {
        var res = await fetch("/api/users");
        if (!res.ok) throw new Error("API Error");
        var users = await res.json();

        var grid = document.getElementById("user-grid");
        grid.innerHTML = "";

        if (users.length === 0) {
            grid.innerHTML = '<p style="color: #6b7280; grid-column: 1/-1;">é‚„æ²’æœ‰ç©å®¶ï¼Œè«‹æ–°å¢ä¸€å€‹ï¼</p>';
        } else {
            users.forEach(function(u) {
                var div = document.createElement("div");
                div.className = "user-card";
                div.innerHTML = '<div class="user-avatar">' + u.avatar + '</div>' +
                    '<div class="user-name">' + u.name + '</div>' +
                    '<div class="user-level">LV.' + u.level + '</div>';
                div.addEventListener("click", function() { selectUser(u); });
                grid.appendChild(div);
            });
        }
        setStatus("âœ… å·²é€£ç·š", "online");
    } catch (e) {
        setStatus("âŒ é€£ç·šå¤±æ•—: " + e.message, "error");
    }
}

async function createUser(name) {
    try {
        await fetch("/api/users", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: name })
        });
        fetchUsers();
    } catch (e) {
        alert("å»ºç«‹å¤±æ•—: " + e.message);
    }
}

async function fetchLevels() {
    try {
        var res = await fetch("/api/levels");
        var levels = await res.json();

        var grid = document.getElementById("level-grid");
        var empty = document.getElementById("empty-levels");
        grid.innerHTML = "";

        if (levels.length === 0) {
            empty.classList.remove("hidden");
        } else {
            empty.classList.add("hidden");
            levels.forEach(function(l) {
                var div = document.createElement("div");
                div.className = "level-card";
                div.innerHTML = '<div class="level-num">' + l.id + '</div>' +
                    '<div class="level-words">' + l.word_count + ' å–®å­—</div>' +
                    '<div class="level-difficulty diff-' + l.difficulty + '">' + l.difficulty + '</div>';
                div.addEventListener("click", function() { startGame(l); });
                grid.appendChild(div);
            });
        }
    } catch (e) {
        console.error("fetchLevels error:", e);
    }
}

async function fetchAllWords() {
    try {
        var res = await fetch("/api/levels");
        var levels = await res.json();
        allWords = [];
        for (var i = 0; i < levels.length; i++) {
            var wordsRes = await fetch("/api/game/start/" + levels[i].id + "?count=100");
            var words = await wordsRes.json();
            allWords = allWords.concat(words);
        }
    } catch (e) {
        console.error("fetchAllWords error:", e);
    }
}

async function fetchAdminLevels() {
    try {
        var res = await fetch("/api/levels");
        var levels = await res.json();

        var list = document.getElementById("admin-level-list");
        list.innerHTML = "";

        if (levels.length === 0) {
            list.innerHTML = '<p style="color: #6b7280;">æ²’æœ‰é—œå¡</p>';
        } else {
            levels.forEach(function(l) {
                var div = document.createElement("div");
                div.className = "level-list-item";

                var span = document.createElement("span");
                span.textContent = l.title + " (" + l.word_count + " å­—)";

                var btn = document.createElement("button");
                btn.className = "btn btn-danger";
                btn.style.cssText = "padding: 8px 16px; font-size: 14px;";
                btn.textContent = "åˆªé™¤";
                btn.addEventListener("click", function() { deleteLevel(l.id); });

                div.appendChild(span);
                div.appendChild(btn);
                list.appendChild(div);
            });
        }
    } catch (e) {
        console.error("fetchAdminLevels error:", e);
    }
}

async function deleteLevel(id) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤é—œå¡ï¼Ÿ")) {
        await fetch("/api/admin/levels/" + id, { method: "DELETE" });
        fetchAdminLevels();
        fetchLevels();
    }
}

// ===== GAME LOGIC =====
function selectUser(u) {
    currentUser = u;
    document.getElementById("dash-avatar").textContent = u.avatar;
    document.getElementById("dash-name").textContent = u.name;
    document.getElementById("dash-level").textContent = "LV." + u.level;
    switchView("dashboard-view");
    fetchLevels();
    fetchAllWords();
}

async function startGame(level) {
    currentLevel = level;
    try {
        var res = await fetch("/api/game/start/" + level.id + "?count=5");
        gameWords = await res.json();

        if (gameWords.length === 0) {
            alert("é€™å€‹é—œå¡æ²’æœ‰å–®å­—ï¼");
            return;
        }

        currentWordIndex = 0;
        correctCount = 0;
        switchView("game-view");
        showQuestion();
    } catch (e) {
        alert("ç„¡æ³•é–‹å§‹éŠæˆ²: " + e.message);
    }
}

function showQuestion() {
    if (currentWordIndex >= gameWords.length) {
        endGame();
        return;
    }

    var word = gameWords[currentWordIndex];
    document.getElementById("word-english").textContent = word.word;
    document.getElementById("progress-fill").style.width = (currentWordIndex / gameWords.length * 100) + "%";
    document.getElementById("progress-text").textContent = currentWordIndex + "/" + gameWords.length;

    // Generate choices (1 correct + 3 wrong)
    var choices = [{ meaning: word.meaning, correct: true }];

    // Get wrong choices from other words
    var otherWords = allWords.filter(function(w) { return w.meaning !== word.meaning; });
    otherWords = shuffleArray(otherWords);

    for (var i = 0; i < 3 && i < otherWords.length; i++) {
        choices.push({ meaning: otherWords[i].meaning, correct: false });
    }

    // If not enough words, add placeholder
    while (choices.length < 4) {
        choices.push({ meaning: "???", correct: false });
    }

    choices = shuffleArray(choices);

    // Render choices
    var container = document.getElementById("choices");
    container.innerHTML = "";

    choices.forEach(function(c) {
        var btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = c.meaning;
        btn.addEventListener("click", function() { selectAnswer(btn, c.correct); });
        container.appendChild(btn);
    });
}

function selectAnswer(btn, isCorrect) {
    // Disable all buttons
    var buttons = document.querySelectorAll(".choice-btn");
    buttons.forEach(function(b) { b.disabled = true; });

    if (isCorrect) {
        btn.classList.add("correct");
        correctCount++;
    } else {
        btn.classList.add("wrong");
        // Show correct answer
        buttons.forEach(function(b) {
            if (b.textContent === gameWords[currentWordIndex].meaning) {
                b.classList.add("correct");
            }
        });
    }

    // Next question after delay
    setTimeout(function() {
        currentWordIndex++;
        showQuestion();
    }, 1000);
}

async function endGame() {
    var xp = correctCount * 20;
    var emoji = correctCount === gameWords.length ? "ğŸ‰" : (correctCount >= gameWords.length / 2 ? "ğŸ‘" : "ğŸ’ª");
    var title = correctCount === gameWords.length ? "å®Œç¾ï¼" : (correctCount >= gameWords.length / 2 ? "åšå¾—å¥½ï¼" : "ç¹¼çºŒåŠ æ²¹ï¼");

    document.getElementById("result-emoji").textContent = emoji;
    document.getElementById("result-title").textContent = title;
    document.getElementById("result-score").textContent = "ç­”å° " + correctCount + "/" + gameWords.length + " é¡Œï¼Œç²å¾— " + xp + " XPï¼";
    document.getElementById("result-overlay").classList.remove("hidden");

    // Update XP
    if (xp > 0 && currentUser) {
        try {
            await fetch("/api/users/" + currentUser.id + "/progress?xp_gained=" + xp, { method: "POST" });
            currentUser.xp += xp;
            currentUser.level = Math.floor(currentUser.xp / 100) + 1;
            document.getElementById("dash-level").textContent = "LV." + currentUser.level;
        } catch (e) {
            console.error("Update XP error:", e);
        }
    }
}

// ===== EVENT LISTENERS =====
document.addEventListener("DOMContentLoaded", function() {
    console.log("Ian's Word Quest V9 loaded");

    // Login view
    document.getElementById("btn-add-player").addEventListener("click", function() {
        document.getElementById("modal-add-user").classList.remove("hidden");
        document.getElementById("input-username").focus();
    });

    document.getElementById("btn-cancel-add").addEventListener("click", function() {
        document.getElementById("modal-add-user").classList.add("hidden");
        document.getElementById("input-username").value = "";
    });

    document.getElementById("btn-confirm-add").addEventListener("click", function() {
        var name = document.getElementById("input-username").value.trim();
        if (!name) {
            alert("è«‹è¼¸å…¥åå­—");
            return;
        }
        createUser(name);
        document.getElementById("modal-add-user").classList.add("hidden");
        document.getElementById("input-username").value = "";
    });

    // Dashboard
    document.getElementById("btn-logout").addEventListener("click", function() {
        currentUser = null;
        switchView("login-view");
        fetchUsers();
    });

    document.getElementById("btn-admin").addEventListener("click", function() {
        switchView("admin-view");
        fetchAdminLevels();
    });

    // Game
    document.getElementById("btn-quit").addEventListener("click", function() {
        if (confirm("ç¢ºå®šè¦é›¢é–‹ï¼Ÿ")) {
            switchView("dashboard-view");
        }
    });

    // Result
    document.getElementById("btn-result-ok").addEventListener("click", function() {
        document.getElementById("result-overlay").classList.add("hidden");
        switchView("dashboard-view");
    });

    // Admin
    document.getElementById("btn-back-dash").addEventListener("click", function() {
        switchView("dashboard-view");
    });

    document.getElementById("upload-form").addEventListener("submit", async function(e) {
        e.preventDefault();
        var btn = document.getElementById("btn-upload");
        var status = document.getElementById("upload-status");
        var formData = new FormData(e.target);

        btn.disabled = true;
        btn.textContent = "ä¸Šå‚³ä¸­...";
        status.textContent = "";

        try {
            var res = await fetch("/api/admin/upload", { method: "POST", body: formData });
            if (res.ok) {
                status.textContent = "âœ… ä¸Šå‚³æˆåŠŸï¼";
                status.style.color = "#22c55e";
                e.target.reset();
                fetchAdminLevels();
            } else {
                var data = await res.json();
                throw new Error(data.detail);
            }
        } catch (err) {
            status.textContent = "âŒ " + err.message;
            status.style.color = "#ef4444";
        } finally {
            btn.disabled = false;
            btn.textContent = "ä¸Šå‚³";
        }
    });

    // Initial load
    fetchUsers();
});
</script>
</body>
</html>
